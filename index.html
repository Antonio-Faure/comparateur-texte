<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comparateur de Textes</title>
  <!-- Favicon SVG inline â€” loupe avec deux couleurs thÃ¨me -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='26' cy='26' r='18' fill='none' stroke='%23e94560' stroke-width='7'/%3E%3Cline x1='39' y1='39' x2='57' y2='57' stroke='%234a9eff' stroke-width='7' stroke-linecap='round'/%3E%3Ccircle cx='22' cy='22' r='5' fill='%23e94560' opacity='.35'/%3E%3C/svg%3E"/>
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VARIABLES CSS â€” trois thÃ¨mes dÃ©finis sur :root puis surchargÃ©s
       par les classes .theme-chrome / .theme-opera / .theme-light
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      /* ThÃ¨me par dÃ©faut = clair */
      --bg-page:        #f0f2f5;
      --bg-card:        #ffffff;
      --bg-card2:       #f7f8fa;
      --border:         #dde1e7;
      --text-primary:   #1a1a2e;
      --text-secondary: #555555;
      --text-muted:     #aaaaaa;
      --accent:         #4a9eff;
      --accent-hover:   #2a7fd4;
      --btn-clear-bg:   #eef0f4;
      --btn-clear-txt:  #555555;
      --shadow:         rgba(0,0,0,.08);
      --badge-eq-bg:    #eef0f4;
      --badge-eq-border:#aaaaaa;
      --label-del:      #e05050;
      --label-add:      #34a853;
      --stat-neutral:   #333333;
      --focus-ring:     rgba(74,158,255,.18);
      --header-gradient:linear-gradient(135deg,#4a9eff 0%,#a78bfa 100%);
      --indicator-dot:  #4a9eff;
    }

    /* â”€â”€ ThÃ¨me Chrome : bordeaux / marron chaud â”€â”€ */
    .theme-chrome {
      --bg-page:        #30191E;
      --bg-card:        #4F3439;
      --bg-card2:       #3d2428;
      --border:         #6B4C51;
      --text-primary:   #f5e6e8;
      --text-secondary: #d4b8bb;
      --text-muted:     #9a7a7e;
      --accent:         #e94560;
      --accent-hover:   #c73050;
      --btn-clear-bg:   #6B4C51;
      --btn-clear-txt:  #f5e6e8;
      --shadow:         rgba(0,0,0,.35);
      --badge-eq-bg:    #5a3d42;
      --badge-eq-border:#8a6065;
      --focus-ring:     rgba(233,69,96,.25);
      --header-gradient:linear-gradient(135deg,#e94560 0%,#a0304a 100%);
      --indicator-dot:  #e94560;
    }

    /* â”€â”€ ThÃ¨me Opera : bleu nuit / noir profond â”€â”€ */
    .theme-opera {
      --bg-page:        #0a0e27;
      --bg-card:        #1a1f3a;
      --bg-card2:       #131728;
      --border:         #2a3f5f;
      --text-primary:   #e2e8f8;
      --text-secondary: #94a3c4;
      --text-muted:     #4a5a80;
      --accent:         #4a9eff;
      --accent-hover:   #2a7fd4;
      --btn-clear-bg:   #2a3f5f;
      --btn-clear-txt:  #e2e8f8;
      --shadow:         rgba(0,0,0,.5);
      --badge-eq-bg:    #1e2d4a;
      --badge-eq-border:#3a5070;
      --focus-ring:     rgba(74,158,255,.2);
      --header-gradient:linear-gradient(135deg,#4a9eff 0%,#7c3aed 100%);
      --indicator-dot:  #4a9eff;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BASE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-page);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 2rem 1rem 3rem;
      transition: background .35s, color .35s;
    }

    .wrapper {
      max-width: 980px;
      margin: 0 auto;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .header-title {
      display: inline-block;
      font-size: 2rem;
      font-weight: 800;
      letter-spacing: -0.5px;
      background: var(--header-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header p {
      color: var(--text-secondary);
      margin-top: .45rem;
      font-size: .95rem;
    }

    /* Badge navigateur dÃ©tectÃ© */
    .browser-info {
      display: inline-flex;
      align-items: center;
      gap: .45rem;
      margin-top: .9rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: .3rem .85rem;
      font-size: .78rem;
      color: var(--text-secondary);
      box-shadow: 0 2px 6px var(--shadow);
      transition: background .35s, border-color .35s;
    }

    .browser-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--indicator-dot);
      box-shadow: 0 0 6px var(--indicator-dot);
      flex-shrink: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SÃ‰LECTEUR DE THÃˆME MANUEL
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .theme-switcher {
      display: flex;
      justify-content: center;
      gap: .5rem;
      margin-bottom: 1.75rem;
      flex-wrap: wrap;
    }

    .theme-btn {
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 20px;
      padding: .3rem .9rem;
      font-size: .78rem;
      font-weight: 600;
      transition: border-color .2s, transform .12s, opacity .2s;
      letter-spacing: .03em;
      font-family: inherit;
    }

    .theme-btn:hover { transform: translateY(-1px); opacity: .9; }
    .theme-btn.active { border-color: var(--accent) !important; }

    /* Couleurs fixes pour chaque bouton (indÃ©pendantes du thÃ¨me actif) */
    .theme-btn[data-theme="chrome"] { background: #4F3439; color: #f5e6e8; }
    .theme-btn[data-theme="opera"]  { background: #1a1f3a; color: #e2e8f8; }
    .theme-btn[data-theme="light"]  { background: #f0f2f5; color: #333; border-color: #ccc; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INPUT GRID
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.25rem;
    }

    @media (max-width: 620px) {
      .input-grid { grid-template-columns: 1fr; }
    }

    .input-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1.25rem;
      box-shadow: 0 3px 12px var(--shadow);
      transition: background .35s, border-color .35s;
    }

    .input-card label {
      display: flex;
      align-items: center;
      font-weight: 600;
      font-size: .8rem;
      text-transform: uppercase;
      letter-spacing: .07em;
      margin-bottom: .65rem;
      color: var(--text-secondary);
    }

    .num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px; height: 20px;
      border-radius: 50%;
      font-size: .7rem;
      color: #fff;
      margin-right: 7px;
      flex-shrink: 0;
    }

    .label-original .num { background: var(--label-del); }
    .label-modifie  .num { background: var(--label-add); }

    textarea {
      width: 100%;
      height: 185px;
      resize: vertical;
      border: 1.5px solid var(--border);
      border-radius: 9px;
      padding: .75rem;
      font-size: .92rem;
      line-height: 1.65;
      color: var(--text-primary);
      background: var(--bg-card2);
      transition: border-color .2s, background .35s, color .35s;
      font-family: inherit;
    }

    textarea::placeholder { color: var(--text-muted); }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--focus-ring);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ACTIONS BAR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .actions {
      display: flex;
      align-items: center;
      gap: .75rem;
      margin: 1.3rem 0;
      flex-wrap: wrap;
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 9px;
      font-size: .92rem;
      font-weight: 600;
      padding: .68rem 1.5rem;
      transition: opacity .18s, transform .12s, box-shadow .18s;
      font-family: inherit;
    }

    button:hover  { opacity: .88; box-shadow: 0 4px 14px var(--shadow); }
    button:active { transform: scale(.97); }

    #btn-comparer {
      background: var(--accent);
      color: #fff;
      flex: 1;
      min-width: 140px;
    }

    #btn-effacer {
      background: var(--btn-clear-bg);
      color: var(--btn-clear-txt);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LÃ‰GENDE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .legend {
      display: flex;
      gap: 1.2rem;
      font-size: .81rem;
      color: var(--text-secondary);
      flex-wrap: wrap;
    }

    .legend-item { display: flex; align-items: center; gap: .35rem; }

    .badge {
      display: inline-block;
      width: 14px; height: 14px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .badge-add { background: rgba(52,168,83,.25);  border: 1.5px solid #34a853; }
    .badge-del { background: rgba(224,80,80,.2);   border: 1.5px solid #e05050; }
    .badge-eq  { background: var(--badge-eq-bg);   border: 1.5px solid var(--badge-eq-border); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STATS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #stats {
      font-size: .82rem;
      color: var(--text-secondary);
      margin-bottom: .75rem;
      min-height: 1.2em;
    }

    .stat-neutral { font-weight: 700; color: var(--text-primary); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ZONE RÃ‰SULTAT
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .section-label {
      font-size: .75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--text-muted);
      margin-bottom: .5rem;
    }

    #zone-resultat {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 1.5rem 1.75rem;
      box-shadow: 0 3px 12px var(--shadow);
      line-height: 2;
      font-size: .95rem;
      min-height: 90px;
      word-break: break-word;
      transition: background .35s, border-color .35s;
    }

    #zone-resultat .placeholder {
      color: var(--text-muted);
      font-style: italic;
    }

    /* â”€â”€ Tokens diff â”€â”€ */
    .token-ajout {
      background: rgba(52,168,83,.18);
      color: #1a7a3a;
      border: 1px solid rgba(52,168,83,.4);
      border-radius: 4px;
      padding: 1px 5px;
      font-weight: 600;
    }

    /* Vert plus lumineux pour les thÃ¨mes sombres */
    .theme-chrome .token-ajout,
    .theme-opera  .token-ajout {
      background: rgba(52,168,83,.2);
      color: #6dd98a;
    }

    .token-suppression {
      background: rgba(224,80,80,.15);
      color: #a01818;
      border: 1px solid rgba(224,80,80,.35);
      border-radius: 4px;
      padding: 1px 5px;
      text-decoration: line-through;
      font-weight: 600;
    }

    /* Rouge plus lumineux pour les thÃ¨mes sombres */
    .theme-chrome .token-suppression,
    .theme-opera  .token-suppression {
      background: rgba(224,80,80,.2);
      color: #ff8080;
    }
  </style>
</head>
<body>
<div class="wrapper">

  <!-- â•â• HEADER â•â• -->
  <header>
    <div class="header-title">ğŸ” Comparateur de Textes</div>
    <p>Collez deux versions d'un texte pour visualiser les diffÃ©rences mot par mot.</p>
    <div class="browser-info">
      <span class="browser-dot"></span>
      <span id="browser-label">DÃ©tection du navigateurâ€¦</span>
    </div>
  </header>

  <!-- â•â• SÃ‰LECTEUR DE THÃˆME MANUEL â•â• -->
  <div class="theme-switcher">
    <button class="theme-btn" data-theme="chrome">ğŸŒ¹ Chrome (bordeaux)</button>
    <button class="theme-btn" data-theme="opera" >ğŸŒ‘ Bleu nuit</button>
    <button class="theme-btn" data-theme="light" >â˜€ï¸ Clair</button>
  </div>

  <!-- â•â• ZONES DE SAISIE â•â• -->
  <div class="input-grid">
    <div class="input-card">
      <label class="label-original">
        <span class="num">1</span>Texte original
      </label>
      <textarea id="texte1" placeholder="Collez le texte original iciâ€¦"></textarea>
    </div>

    <div class="input-card">
      <label class="label-modifie">
        <span class="num">2</span>Texte modifiÃ©
      </label>
      <textarea id="texte2" placeholder="Collez le texte modifiÃ© iciâ€¦"></textarea>
    </div>
  </div>

  <!-- â•â• ACTIONS + LÃ‰GENDE â•â• -->
  <div class="actions">
    <button id="btn-comparer">âš¡ Comparer</button>
    <button id="btn-effacer">âœ• Effacer</button>

    <div class="legend">
      <div class="legend-item"><span class="badge badge-add"></span> Mot ajoutÃ©</div>
      <div class="legend-item"><span class="badge badge-del"></span> Mot supprimÃ©</div>
      <div class="legend-item"><span class="badge badge-eq"></span>  Mot identique</div>
    </div>
  </div>

  <!-- â•â• STATISTIQUES â•â• -->
  <div id="stats"></div>

  <!-- â•â• RÃ‰SULTAT â•â• -->
  <div class="section-label">RÃ©sultat</div>
  <div id="zone-resultat">
    <span class="placeholder">Le rÃ©sultat de la comparaison apparaÃ®tra iciâ€¦</span>
  </div>

</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   1. DÃ‰TECTION DU NAVIGATEUR ET APPLICATION DU THÃˆME
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/**
 * Retourne 'chrome' | 'opera' | 'other' selon le navigateur dÃ©tectÃ©.
 * Utilise l'User-Agent et des propriÃ©tÃ©s spÃ©cifiques Ã  chaque moteur.
 */
function detecterNavigateur() {
  const ua  = navigator.userAgent.toLowerCase();
  const win = window;

  // Opera : propriÃ©tÃ© window.opr ou 'opr/' dans l'UA (Chromium-Opera)
  if (win.opr !== undefined || win.opera !== undefined ||
      ua.includes('opr/') || ua.includes('opera')) {
    return 'opera';
  }
  // Chrome : prÃ©sence de 'chrome' dans l'UA, sans Opera ni Edge
  if (ua.includes('chrome') && !ua.includes('edg') && !ua.includes('opr')) {
    return 'chrome';
  }
  // Firefox, Safari, Edge, etc. â†’ thÃ¨me clair
  return 'other';
}

/**
 * Applique le thÃ¨me sur <body> et synchronise les boutons du switcher.
 * @param {'chrome'|'opera'|'light'} theme
 */
function appliquerTheme(theme) {
  const body = document.body;

  // Retire les classes de thÃ¨mes sombres
  body.classList.remove('theme-chrome', 'theme-opera');

  if      (theme === 'chrome') body.classList.add('theme-chrome');
  else if (theme === 'opera')  body.classList.add('theme-opera');
  // 'light' â†’ aucune classe supplÃ©mentaire (variables :root utilisÃ©es)

  // Marque le bouton actif
  document.querySelectorAll('.theme-btn').forEach(function(btn) {
    btn.classList.toggle('active', btn.dataset.theme === theme);
  });
}

/* â”€â”€ DÃ©tection automatique au chargement de la page â”€â”€ */
(function() {
  const nav   = detecterNavigateur();
  const label = document.getElementById('browser-label');
  const noms  = {
    chrome : 'ğŸŒ¹ Chrome dÃ©tectÃ© â€” thÃ¨me bordeaux appliquÃ©',
    opera  : 'ğŸŒ‘ Opera dÃ©tectÃ© â€” thÃ¨me bleu nuit appliquÃ©',
    other  : 'â˜€ï¸ Navigateur standard â€” thÃ¨me clair appliquÃ©'
  };

  // Mappe 'other' â†’ 'light' pour appliquerTheme
  const themeMap = { chrome: 'chrome', opera: 'opera', other: 'light' };

  appliquerTheme(themeMap[nav]);
  label.textContent = noms[nav];

  // Sur Chrome : on masque le bouton "Chrome" du sÃ©lecteur manuel
  // (le thÃ¨me est dÃ©jÃ  appliquÃ© automatiquement, inutile de le proposer)
  if (nav === 'chrome') {
    const btnChrome = document.querySelector('.theme-btn[data-theme="chrome"]');
    if (btnChrome) btnChrome.style.display = 'none';
  }
})();

/* â”€â”€ Clics manuels sur les boutons de thÃ¨me â”€â”€ */
document.querySelectorAll('.theme-btn').forEach(function(btn) {
  btn.addEventListener('click', function() {
    appliquerTheme(btn.dataset.theme);
    const noms = {
      chrome : 'ğŸŒ¹ ThÃ¨me bordeaux sÃ©lectionnÃ© manuellement',
      opera  : 'ğŸŒ‘ ThÃ¨me bleu nuit sÃ©lectionnÃ© manuellement',
      light  : 'â˜€ï¸ ThÃ¨me clair sÃ©lectionnÃ© manuellement'
    };
    document.getElementById('browser-label').textContent = noms[btn.dataset.theme];
  });
});


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   2. ALGORITHME LCS (Longest Common Subsequence)
   Permet de dÃ©tecter les ajouts/suppressions mÃªme quand des mots
   sont insÃ©rÃ©s au milieu, contrairement Ã  une simple comparaison
   index par index.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/**
 * Construit la table de programmation dynamique LCS.
 * dp[i][j] = longueur de la plus longue sous-sÃ©quence commune
 *            entre a[0..i-1] et b[0..j-1].
 * @param {string[]} a  mots du texte 1
 * @param {string[]} b  mots du texte 2
 * @returns {number[][]}
 */
function lcsTable(a, b) {
  const m  = a.length, n = b.length;
  const dp = Array.from({ length: m + 1 }, () => new Array(n + 1).fill(0));

  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      if (a[i - 1].toLowerCase() === b[j - 1].toLowerCase()) {
        dp[i][j] = dp[i - 1][j - 1] + 1;   // correspondance trouvÃ©e
      } else {
        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
      }
    }
  }
  return dp;
}

/**
 * Remonte la table LCS (backtracking) pour reconstruire le diff.
 * Retourne un tableau de tokens : { type: 'eq'|'add'|'del', word }
 * @param {number[][]} dp
 * @param {string[]} a
 * @param {string[]} b
 * @param {number}   i  ligne courante (dÃ©bute Ã  a.length)
 * @param {number}   j  colonne courante (dÃ©bute Ã  b.length)
 * @returns {Array<{type:string, word:string}>}
 */
function retracerDiff(dp, a, b, i, j) {
  // Cas de base : plus rien Ã  traiter
  if (i === 0 && j === 0) return [];

  // Plus de mots dans a â†’ tout ce qui reste dans b est un ajout
  if (i === 0) {
    return [...retracerDiff(dp, a, b, 0, j - 1), { type: 'add', word: b[j - 1] }];
  }
  // Plus de mots dans b â†’ tout ce qui reste dans a est une suppression
  if (j === 0) {
    return [...retracerDiff(dp, a, b, i - 1, 0), { type: 'del', word: a[i - 1] }];
  }

  // Mot identique (insensible Ã  la casse) â€” on garde la casse du texte 2
  if (a[i - 1].toLowerCase() === b[j - 1].toLowerCase()) {
    return [...retracerDiff(dp, a, b, i - 1, j - 1), { type: 'eq', word: b[j - 1] }];
  }

  // On remonte dans la direction qui maximise le LCS
  if (dp[i - 1][j] >= dp[i][j - 1]) {
    return [...retracerDiff(dp, a, b, i - 1, j), { type: 'del', word: a[i - 1] }];
  } else {
    return [...retracerDiff(dp, a, b, i, j - 1), { type: 'add', word: b[j - 1] }];
  }
}

/** DÃ©coupe un texte en tableau de mots (filtre les chaÃ®nes vides). */
function tokeniser(texte) {
  return texte.trim().split(/\s+/).filter(Boolean);
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   3. GESTIONNAIRES D'Ã‰VÃ‰NEMENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Bouton Comparer â”€â”€ */
document.getElementById('btn-comparer').addEventListener('click', function () {
  const t1 = document.getElementById('texte1').value;
  const t2 = document.getElementById('texte2').value;

  if (!t1.trim() || !t2.trim()) {
    afficherErreur('âš ï¸ Veuillez remplir les deux zones de texte avant de comparer.');
    return;
  }

  const mots1 = tokeniser(t1);
  const mots2 = tokeniser(t2);

  // Calcul LCS puis reconstruction du diff
  const dp   = lcsTable(mots1, mots2);
  const diff = retracerDiff(dp, mots1, mots2, mots1.length, mots2.length);

  afficherResultat(diff);
});

/* â”€â”€ Bouton Effacer â”€â”€ */
document.getElementById('btn-effacer').addEventListener('click', function () {
  document.getElementById('texte1').value = '';
  document.getElementById('texte2').value = '';
  document.getElementById('zone-resultat').innerHTML =
    '<span class="placeholder">Le rÃ©sultat de la comparaison apparaÃ®tra iciâ€¦</span>';
  document.getElementById('stats').textContent = '';
});

/* â”€â”€ Raccourci Ctrl+EntrÃ©e dans les textareas â”€â”€ */
[document.getElementById('texte1'), document.getElementById('texte2')]
  .forEach(function (el) {
    el.addEventListener('keydown', function (e) {
      if (e.key === 'Enter' && e.ctrlKey) {
        document.getElementById('btn-comparer').click();
      }
    });
  });


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   4. RENDU DU RÃ‰SULTAT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/**
 * GÃ©nÃ¨re et injecte le HTML diff colorÃ©, puis met Ã  jour les stats.
 * @param {Array<{type:string, word:string}>} diff
 */
function afficherResultat(diff) {
  let html        = '';
  let nbAjout     = 0;
  let nbSupprime  = 0;
  let nbIdentique = 0;

  diff.forEach(function (token) {
    const mot = echapper(token.word);   // sÃ©curise les caractÃ¨res HTML

    if (token.type === 'add') {
      html += `<span class="token-ajout" title="Mot ajoutÃ©">${mot}</span> `;
      nbAjout++;
    } else if (token.type === 'del') {
      html += `<span class="token-suppression" title="Mot supprimÃ©">${mot}</span> `;
      nbSupprime++;
    } else {
      html += mot + ' ';
      nbIdentique++;
    }
  });

  document.getElementById('zone-resultat').innerHTML =
    html.trim() || '<em>Les deux textes sont identiques.</em>';

  // Barre de statistiques
  document.getElementById('stats').innerHTML =
    `<span class="stat-neutral">${nbIdentique}</span> mot(s) identique(s) &nbsp;Â·&nbsp; ` +
    `<span class="stat-neutral" style="color:#34a853">${nbAjout}</span> ajout(s) &nbsp;Â·&nbsp; ` +
    `<span class="stat-neutral" style="color:#e05050">${nbSupprime}</span> suppression(s)`;
}

/** Affiche un message d'erreur dans la zone rÃ©sultat. */
function afficherErreur(msg) {
  document.getElementById('zone-resultat').innerHTML =
    `<span style="color:var(--accent)">${msg}</span>`;
  document.getElementById('stats').textContent = '';
}

/**
 * Ã‰chappe les caractÃ¨res HTML spÃ©ciaux pour prÃ©venir les injections.
 * @param {string} str
 * @returns {string}
 */
function echapper(str) {
  return str
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}
</script>
</body>
</html>
